- id: alarm_trigger
  alias: Trigger alarm while armed away
  trigger:
  - device_id: f918e214648f4e25848333fcea985dfe
    domain: binary_sensor
    entity_id: binary_sensor.snug_motion
    platform: device
    type: motion
  - device_id: f918e214648f4e25848333fcea985dfe
    domain: binary_sensor
    entity_id: binary_sensor.dining_room_motion
    platform: device
    type: motion
  - device_id: f918e214648f4e25848333fcea985dfe
    domain: binary_sensor
    entity_id: binary_sensor.utility_room_motion
    platform: device
    type: motion
  - device_id: f918e214648f4e25848333fcea985dfe
    domain: binary_sensor
    entity_id: binary_sensor.cellar_door
    platform: device
    type: opened
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarm
    state: armed_away
  action:
  - data: {}
    entity_id: alarm_control_panel.alarm
    service: alarm_control_panel.alarm_trigger
- alias: Send notification when alarm triggered
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarm
    to: triggered
  action:
  - data:
      title: Alarm Triggered
      message: ALARM! The alarm has been triggered
      data:
        file_url: https://media.istockphoto.com/vectors/vector-fire-alarm-vector-id610426096?k=6&m=610426096&s=612x612&w=0&h=IIjBibeAUNdoq7XS4-esMGyxxw_xFkb07zbwKcwNB-I=
      target:
      - email/mcinnes01@gmail.com
      - device/AndyPhone
    service: notify.pushbullet
  - data:
      title: Alarm Triggered
      message: The alarm has been triggered. The alarm has been triggered. The alarm
        has been triggered. The alarm has been triggered. The alarm has been triggered.
      target:
      - media_player.everywhere
      data:
        type: announce
    service: notify.alexa_media
  id: 33a13ad590164e5a9542f8223820a928
- alias: Turn On Ex Machina lights when alarm triggered
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarm
    to: triggered
  action:
  - data: {}
    entity_id: light.inside
    service: light.turn_off
  - data:
      brightness_pct: 100
      effect: Alarm
    entity_id: light.yeelights
    service: light.turn_on
  id: 71bcd308a0bc484793b7d78e8ec8e69d
- alias: Send notification when alarm is Disarmed
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarm
    to: disarmed
  action:
  - data:
      type: announce
    service: notify.alexa_media
    data_template:
      title: Alarm disarmed
      message: ALARM! The alarm is Disarmed at {{ states('sensor.date_time') }}
      target:
      - media_player.everywhere
  id: 63385e6035f643aab8b67f619af4951b
- alias: Turn Off Ex Machina lights when alarm disarmed
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarm
    to: disarmed
  action:
  - data:
      effect: Stop
    entity_id: light.yeelights
    service: light.turn_on
  - data: {}
    entity_id: light.yeelights
    service: light.turn_off
  id: 71bcd308a0bc484793b7d78e8ec8e69f
- id: a71c90774150444f9237ba14769e935a
  alias: Send notification when alarm is arming
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarm
    from: disarmed
    to: pending
  action:
  - service: notify.alexa_media
    data_template:
      title: Alarm arming
      message: The alarm is arming you have 60 seconds to leave
      target:
      - media_player.everywhere
      data:
        type: announce
  mode: single
- alias: Send notification when alarm is pending
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarm
    from: armed
    to: pending
  action:
  - service: notify.alexa_media
    data_template:
      title: Alarm pending
      message: You have 30 seconds to disable the alarm
      target:
      - media_player.everywhere
      data:
        type: announce
  id: df6ae52914e648ec8d170fc4e508c29e
- alias: Send notification when alarm is Armed in Away mode
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarm
    to: armed_away
  action:
  - service: notify.alexa_media
    data_template:
      title: Alarm armed in away mode
      message: The alarm is armed in Away mode
      target:
      - media_player.everywhere
      data:
        type: announce
  id: e430701364844f3da246e6f2db218214
- alias: Send notification when alarm is Armed in Home mode
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarm
    to: armed_home
  action:
  - service: notify.alexa_media
    data_template:
      title: Alarm armed in home mode
      message: The alarm is armed in Home mode
      target:
      - media_player.everywhere
      data:
        type: announce
  id: b762a0f5608845a2800b4b408924d844
- id: '1621858546623'
  alias: Andy is home
  description: ''
  trigger:
  - platform: device
    device_id: 646468413e957e6fe0d15b0f9624b670
    domain: device_tracker
    entity_id: device_tracker.andrews_iphone
    type: enters
    zone: zone.home
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: notify.alexa_media_all_speakers
    data:
      message: Welcome home Andy
      title: Andy is home
      data:
        type: announce
        method: all
  mode: single
- alias: Basement Hall Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.basement_hall_light_contrained
    - input_select.ambience
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Day'', ''Evening'']) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.basement_hall_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.basement_hall_light_constrained
  mode: single
  id: 170b8023063a4f83b9aba8cd0771a2d4
- id: '1622719466285'
  alias: Turn on basement hall lights when electric cabinet door is open
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 879be2aff99b3b5eb4f25bc6e00bcb62
    entity_id: binary_sensor.electric_cabinet_door_contact
    domain: binary_sensor
  condition: []
  action:
  - service: light.turn_on
    target:
      entity_id: light.basement_hall
  mode: single
- id: '1622719668545'
  alias: Turn off basement hall light when electric cabinet door closed
  description: ''
  trigger:
  - type: not_opened
    platform: device
    device_id: 879be2aff99b3b5eb4f25bc6e00bcb62
    entity_id: binary_sensor.electric_cabinet_door_contact
    domain: binary_sensor
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    target:
      entity_id: light.basement_hall
  mode: single
- alias: Bathroom Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.bathroom_light_contrained
    - input_select.ambience
    - light.mirror
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Evening''] and is_state(''light.mirror'', ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.bathroom_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.bathroom_light_constrained
  mode: single
  id: f15e5f50e4aa43da84d66f16ea6b95cf
- alias: Mirror Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.mirror_light_contrained
    - input_select.ambience
    - light.bathroom
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening'', ''Night''] and is_state(''light.bathroom'', ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.mirror_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.mirror_light_constrained
  mode: single
  id: c22b53b755fd48b7b10dcba5bfdc3018
- id: '1619549518704'
  alias: Shower timer start
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.bathroom_motion
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.in_shower
    state: 'true'
  action:
  - service: timer.start
    data:
      duration: '600'
  mode: restart
- id: '1619550242949'
  alias: Shower timer finished
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.shower
  condition:
  - condition: state
    entity_id: input_boolean.in_shower
    state: 'true'
  action:
  - service: light.turn_off
    target:
      area_id: cc4d1282baa64200a75e9347f5f87bdb
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.in_shower
  mode: single
- alias: Bedroom Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.bedroom_light_contrained
    - input_select.ambience
    - light.bedside_lamp
    - input_boolean.in_bed
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Evening''] and is_state(''light.bedside_lamp'', ''off'') and is_state(''input_boolean.in_bed'',
          ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.bedroom_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.bedroom_light_constrained
  mode: single
  id: 18c5d98e6cd945ea8089ea36abe3049f
- alias: Bedside Lamp Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.bedside_lamp_contrained
    - input_select.ambience
    - light.bedroom
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening''] and is_state(''light.bedroom'', ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.bedside_lamp_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.bedside_lamp_constrained
  mode: single
  id: e6e53418e5474b03b92123912e18fdd3
- id: '1624467229490'
  alias: In bed
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.in_bed
    to: 'on'
    for: 00:05:00
  condition:
  - condition: time
    after: '20:00:00'
    before: 04:30:00
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.in_bed
  mode: single
- id: '1624870805960'
  alias: Out of bed
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.in_bed
    to: 'off'
    for: 00:05:00
  condition:
  - condition: time
    after: 05:00:00
    before: '12:00:00'
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.in_bed
  mode: single
- id: '1628234751548'
  alias: Feed Cats
  description: Morning and Evening Cat feeding with options to disable next feed or
    turn off morning and/or evening feed
  trigger:
  - platform: time
    at: 07:00
    id: morning-feed
  - platform: time
    at: '17:00'
    id: evening-feed
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: trigger
        id: morning-feed
      - condition: state
        entity_id: binary_sensor.morning_feed_enabled
        state: 'on'
      - condition: state
        entity_id: binary_sensor.morning_feed_complete
        state: 'off'
    - condition: and
      conditions:
      - condition: trigger
        id: evening-feed
      - condition: state
        entity_id: binary_sensor.evening_feed_enabled
        state: 'on'
      - condition: state
        entity_id: input_boolean.evening_feed_complete
        state: 'off'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: morning-feed
      sequence:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.evening_feed_complete
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.disable_next_feed
            state: 'on'
          sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.disable_next_feed
        default:
        - service: switch.turn_on
          target:
            entity_id: switch.dispenser_motor
        - delay:
            hours: 0
            minutes: 1
            seconds: 20
            milliseconds: 0
        - service: input_boolean.turn_on
          target:
            entity_id: input_boolean.morning_feed_complete
    - conditions:
      - condition: trigger
        id: evening-feed
      sequence:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.morning_feed_complete
      - choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.disable_next_feed
            state: 'on'
          sequence:
          - service: input_boolean.turn_off
            target:
              entity_id: input_boolean.disable_next_feed
        default:
        - service: switch.turn_on
          target:
            entity_id: switch.dispenser_motor
        - delay:
            hours: 0
            minutes: 1
            seconds: 20
            milliseconds: 0
        - service: input_boolean.turn_on
          target:
            entity_id: input_boolean.evening_feed_complete
    default: []
  mode: single
- id: '1621858546622'
  alias: Claire is home
  description: ''
  trigger:
  - platform: device
    device_id: 3cf9e880497a947bf86f81e62cdb9fc3
    domain: device_tracker
    entity_id: device_tracker.claires_iphone
    type: enters
    zone: zone.home
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: notify.alexa_media_all_speakers
    data:
      message: Welcome home Claire
      title: Claire is home
      data:
        type: announce
        method: all
  mode: single
- alias: Dining Room Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.dining_room_light_contrained
    - input_select.ambience
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Day'', ''Evening'']) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.dining_room_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.dining_room_light_constrained
  mode: single
  id: 4b6ac44609014c3a8c0127ffaa9e0a9f
- alias: Drawing Room Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.drawing_room_light_constrained
    - input_select.ambience
    - light.bookshelf
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Evening''] and is_state(''light.bookshelf'', ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.drawing_room_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.drawing_room_light_constrained
  mode: single
  id: 93bda13f503c4f5780004a4cdcf1b1ea
- alias: Bookshelf Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.bookshelf_light_contrained
    - input_select.ambience
    - light.drawing_room
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening''] and is_state(''light.drawing_room'', ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.bookshelf_light_contrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.bookshelf_light_contrained
  mode: single
  id: 1dd62d0407af4ba68939726a92353417
- alias: Dressing Room Constrained
  trigger:
  - platform: state
    entity_id:
    - input_select.ambience
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening'']) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.dressing_room_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.dressing_room_light_constrained
  mode: single
  id: 7c5305d3f9704edca32c6df5c5ad399b
- alias: Guest Room Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_select.ambience
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening'']) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.guest_room_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.guest_room_light_constrained
  mode: single
  id: f6d3b5116682406888bd5ffc772efe81
- alias: Hallway Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.hallway_light_contrained
    - input_select.ambience
    - light.hallway_lamp
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Evening''] and is_state(''light.hallway_lamp'', ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.hallway_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.hallway_light_constrained
  mode: single
  id: 5b1af16edd2f419ab2a006d2615e3db2
- alias: Hallway Lamp Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.hallway_light_contrained
    - input_select.ambience
    - light.hallway
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening''] and is_state(''light.hallway'', ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.hallway_lamp_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.hallway_lamp_constrained
  mode: single
  id: b03b0847981b4e1f87e1435b36758a8f
- id: '1622826722616'
  alias: Front door open after sunset
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: e87ea564142edf52ebc5fb9d015444ed
    entity_id: binary_sensor.front_door_contact
    domain: binary_sensor
  condition:
  - condition: sun
    before: sunrise
    after: sunset
    after_offset: -00:30:00
  action:
  - service: light.turn_on
    target:
      entity_id: light.hallway
  mode: single
- id: '1622826801223'
  alias: Front door closed after sunset
  description: ''
  trigger:
  - type: not_opened
    platform: device
    device_id: e87ea564142edf52ebc5fb9d015444ed
    entity_id: binary_sensor.front_door_contact
    domain: binary_sensor
  condition:
  - condition: sun
    before: sunrise
    after: sunset
    after_offset: -00:30:00
  action:
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    target:
      entity_id: light.hallway
  mode: single
- id: f0c65ae0b59c4bfdbb6a9c41f6dfc9cf
  alias: Kitchen Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.kitchen_light_contrained
    - input_select.ambience
    - light.breakfast_bar_lamp
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Evening''] and is_state(''light.breakfast_bar_lamp'', ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.kitchen_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.kitchen_light_constrained
  mode: single
- alias: Breakfast Bar Lamp Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.kitchen_light_contrained
    - input_select.ambience
    - light.kitchen
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening''] and is_state(''light.kitchen'', ''off'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.breakfast_bar_lamp_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.breakfast_bar_lamp_constrained
  mode: single
  id: e8e14ee636a442838221690bbffe178f
- id: 5dd55f812aa8446588f5b6d1b08921d3
  alias: Ambience to Evening
  trigger:
  - event: sunset
    platform: sun
    offset: -01:00:00
  action:
  - service: input_select.select_option
    target:
      entity_id: input_select.ambience
    data:
      option: Evening
  mode: single
- id: '1622742978922'
  alias: Loft hatch open
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 7edaef3b07fdf64472991cfe09e62c2b
    entity_id: binary_sensor.loft_hatch_contact
    domain: binary_sensor
  condition: []
  action:
  - service: notify.alexa_media_all_speakers
    data:
      message: Get off my things!
      data:
        method: all
        type: announce
  mode: single
- id: '1622743049939'
  alias: Loft hatch closed
  description: ''
  trigger:
  - type: not_opened
    platform: device
    device_id: 7edaef3b07fdf64472991cfe09e62c2b
    entity_id: binary_sensor.loft_hatch_contact
    domain: binary_sensor
  condition: []
  action:
  - service: notify.alexa_media_all_speakers
    data:
      message: You better put them back where you found them!
      data:
        method: all
        type: announce
  mode: single
- id: 7370bd68e87044beacd6a72f5028ad5a
  alias: Lounge Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.lounge_light_contrained
    - input_select.ambience
    - input_select.lounge_mode
    - light.lounge_corner_lamp
    - light.lounge_floor_lamp
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Evening''] and is_state(''input_select.lounge_mode'', ''Normal'') and
          is_state(''light.lounge_corner_lamp'', ''on'') and is_state(''light.lounge_floor_lamp'',
          ''on'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.lounge_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.lounge_light_constrained
  mode: single
- id: 34d291332d9d4a9185327573b8c1a89e
  alias: Lounge Corner Lamp Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.lounge_corner_lamp_contrained
    - input_select.ambience
    - input_select.lounge_mode
    - light.lounge
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening''] and is_state(''input_select.lounge_mode'', ''Normal'') and
          is_state(''light.lounge'', ''on'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.lounge_corner_lamp_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.lounge_corner_lamp_constrained
  mode: single
- id: 34d291332d9d4a9185327573b8c1a89f
  alias: Floor Lamp Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.lounge_floor_lamp_contrained
    - input_select.ambience
    - input_select.lounge_mode
    - light.lounge
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening''] and is_state(''input_select.lounge_mode'', ''Normal'') and
          is_state(''light.lounge'', ''on'')) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.lounge_floor_lamp_contrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.lounge_floor_lamp_contrained
  mode: single
- alias: Lounge Scene Watch Television
  id: 34d291332d9d4a9185327573b8c1a90f
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.lounge_mode
    to: Television
  condition: []
  action:
  - service: script.room_controller_reset
    data:
      room: Lounge
  - service: input_boolean.turn_on
    target:
      entity_id:
      - group.lounge_overrides
  - service: light.turn_off
    target:
      entity_id:
      - light.lounge
  - service: yeelight.set_color_temp_scene
    data:
      kelvin: 3700
      brightness: 80
    target:
      entity_id:
      - light.lounge_corner_lamp
      - light.lounge_floor_lamp
  mode: single
- alias: Lounge Motion Lighting
  id: '1627420103277'
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.lounge_motion
    id: lounge-motion-on
    to: 'on'
  - platform: state
    entity_id: binary_sensor.lounge_motion
    id: lounge-motion-off
    to: 'off'
    for: 00:02:00
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_select.lounge_state
      state: Idle
    - condition: state
      entity_id: input_select.lounge_state
      state: Motion
  - condition: and
    conditions:
    - condition: sun
      before: sunrise
      after: sunset
      after_offset: -00:45:00
  - condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.in_bed
      state: 'off'
  action:
  - condition: and
    conditions:
    - condition: trigger
      id: lounge-motion-on
    - condition: sun
      before: sunset
      after: sunset
      before_offset: 03:00:00
      after_offset: -00:45:00
  - service: input_select.select_option
    target:
      entity_id: input_select.lounge_state
    data:
      option: Motion
  - service: light.turn_on
    target:
      entity_id: light.lounge
  - condition: and
    conditions:
    - condition: trigger
      id: lounge-motion-on
    - condition: sun
      before: sunrise
      after: sunset
      after_offset: 03:00:00
  - service: yeelight.set_color_temp_scene
    data:
      kelvin: 3700
      brightness: 50
  - service: input_select.select_option
    target:
      entity_id: input_select.lounge_state
    data:
      option: Motion
  - condition: trigger
    id: lounge-motion-off
  - service: input_select.select_option
    target:
      entity_id: input_select.lounge_state
    data:
      option: Idle
  - service: light.turn_off
    target:
      area_id: f7a90e0bdcf941a6ba0ac65e1dc244ee
  mode: restart
- id: '1612647968540'
  alias: Turn off back door light when no detection or door is shut
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_patio_camera
    attribute: event_object
    to: None Identified
    id: patio-motion-stopped
  - platform: state
    entity_id: binary_sensor.patio_door
    id: patio-door-closed
    to: 'off'
  condition:
  - condition: state
    entity_id: binary_sensor.patio_door
    state: 'off'
  action:
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    entity_id: light.back_door
  mode: restart
- id: '1618138464654'
  alias: Turn on back door light when car or person detected or back door is open
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_patio_camera
    to: person
    attribute: event_object
    id: person-detected
  - platform: state
    entity_id: binary_sensor.motion_patio_camera
    id: car-detected
    attribute: event_object
    to: car
  - platform: state
    entity_id: binary_sensor.patio_door
    id: back-door-opened
    to: 'on'
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.patio_door
      state: 'off'
    - condition: sun
      before: sunrise
      after: sunset
  action:
  - service: light.turn_on
    target:
      entity_id: light.back_door
  mode: single
- id: '1621853753389'
  alias: Patio door is open
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.patio_door
    to: 'on'
  condition: []
  action:
  - service: notify.alexa_media_all_speakers
    data:
      data:
        type: announce
        state: all
      title: Door Open
      message: Patio door is open!
  mode: single
- id: doorbell_trigger
  alias: Doorbell Notifications
  trigger:
  - platform: state
    entity_id: binary_sensor.doorbell_button
    to: 'on'
  action:
  - service: notify.mobile_app_andrews_iphone
    data:
      message: Someone is at the door
      title: Doorbell Rang
  - service: notify.alexa_media_all_speakers
    data:
      message: Ding dong! Someone is at the door!
      title: Doorbell rang
      data:
        method: all
        type: announce
  mode: single
- id: '1579518320766'
  alias: Turn On Porch Light when Sun is set
  trigger:
  - event: sunset
    platform: sun
  action:
  - entity_id: light.porch
    service: light.turn_on
- id: '1579518409890'
  alias: Turn Off Porch Light at 11pm
  trigger:
  - at: '22:30:00'
    platform: time
  action:
  - entity_id: light.porch
    service: light.turn_off
- alias: Snug Scene Normal
  id: '1624997862387'
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.snug_mode
    to: Normal
  condition: []
  action:
  - service: script.room_controller_reset
    data:
      room: Snug
- alias: Snug Scene Watch Movie
  id: '1624997862389'
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.snug_mode
    to: Movie
  condition: []
  action:
  - service: script.room_controller_reset
    data:
      room: Snug
  - service: input_boolean.turn_on
    target:
      entity_id:
      - group.snug_overrides
  - service: light.turn_off
    target:
      entity_id:
      - light.snug
      - light.basement_hall
  - service: light.turn_on
    target:
      entity_id: light.snug_floor_lamp
    data:
      rgb_color: 70,70,255
      brightness: 184
  mode: single
- alias: Studio Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_select.ambience
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Ambient'',
          ''Evening''])}}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.studio_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.studio_light_constrained
  mode: single
  id: 7119d64911784af3a51dfe8e3a058989
- id: '1587464597280'
  alias: Sump Alarm Triggered
  description: The sump is at risk of overflowing, the pump may be offline or broken
  trigger:
  - device_id: 67c16ded941843d59f95ea1394628b0a
    domain: binary_sensor
    entity_id: binary_sensor.sump_alarm_trigger
    platform: device
    type: turned_on
  action:
  - data:
      title: Sump Alarm Triggered
      message: The sump alarm has been triggered, check the sump pump has power, this
        could cause a flood if not attended.
      data:
        file_url: https://media.istockphoto.com/vectors/vector-fire-alarm-vector-id610426096?k=6&m=610426096&s=612x612&w=0&h=IIjBibeAUNdoq7XS4-esMGyxxw_xFkb07zbwKcwNB-I=
      target:
      - email/mcinnes01@gmail.com
      - device/AndyPhone
    service: notify.pushbullet
  - data:
      title: Sump Alarm Triggered
      message: The sump alarm has been triggered, check the sump pump has power, this
        could cause a flood if not attended.
      target:
      - media_player.everywhere
      data:
        type: announce
    service: notify.alexa_media
- alias: Toilet Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.toilet_light_contrained
    - input_select.ambience
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Day'', ''Evening'', ''Ambient'']) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.toilet_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.toilet_light_constrained
  mode: single
  id: f7ad91532b454991b258ed726b18c562
- alias: Utility Room Light Constrained
  trigger:
  - platform: state
    entity_id:
    - input_boolean.utility_room_light_contrained
    - input_select.ambience
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ not (states(''input_select.ambience'') in [''Bright'',
          ''Day'', ''Evening'']) }}'
      sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.utility_room_light_constrained
    default:
    - service: input_boolean.turn_off
      entity_id: input_boolean.utility_room_light_constrained
  mode: single
  id: f26ce7ed75944637890f2ed2016ad2b3
- id: '1628676340481'
  alias: Snug Switch Actions
  description: ''
  use_blueprint:
    path: mcinnes01/zigbee2mqtt-snzb-01.yaml
    input:
      switch: sensor.snug_switch_action
      single_press:
      - choose:
        - conditions:
          - condition: state
            entity_id: light.snug_floor_lamp
            state: 'on'
          sequence:
          - service: light.turn_off
            target:
              entity_id: light.snug_floor_lamp
        - conditions:
          - condition: state
            entity_id: light.snug
            state: 'on'
          sequence:
          - service: light.turn_off
            target:
              entity_id: light.snug
        - conditions:
          - condition: state
            entity_id: light.snug_lights
            state: 'off'
          sequence:
          - service: light.turn_on
            target:
              entity_id: light.snug
        default: []
      double_press:
      - service: light.turn_off
        target:
          entity_id: light.snug
      - service: homeassistant.turn_on
        target:
          entity_id:
          - light.snug_floor_lamp
      long_press:
      - service: automation.trigger
        target:
          entity_id: automation.snug_scene_watch_movie
- id: '1630315543146'
  alias: Ambiance To Day When Out of Bed
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.in_bed
    to: 'off'
  condition:
  - condition: time
    after: 05:00
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  action:
  - service: input_select.select_option
    target:
      entity_id: input_select.ambience
    data:
      option: Day
  mode: single
- id: '1630315855227'
  alias: Ambiance to Day after 9am on a week day
  description: ''
  trigger:
  - platform: time
    at: 09:00
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.in_bed
  mode: single
- id: '1630315926698'
  alias: Ambiance to Day at 12pm at the weekend
  description: ''
  trigger:
  - platform: time
    at: '12:00'
  condition:
  - condition: time
    weekday:
    - sat
    - sun
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.in_bed
  mode: single
- id: '1630316167007'
  alias: Ambiance To Night When In Bed
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.in_bed
    to: 'on'
  condition:
  - condition: time
    after: '20:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  action:
  - service: script.entity_controller_reset
  - service: input_select.select_option
    target:
      entity_id:
      - input_select.ambience
      - input_select.bedroom_mode
    data:
      option: Night
  - service: input_select.select_option
    target:
      entity_id:
      - input_select.lounge_mode
      - input_select.snug_mode
    data:
      option: Normal
  mode: single
- id: '1630316252349'
  alias: Ambiance to Night after 1am on a week day
  description: ''
  trigger:
  - platform: time
    at: 01:00
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - sun
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.in_bed
  mode: single
- id: '1631053304503'
  alias: Send snapshot when person is in the garden - Andy iPhone
  description: ''
  use_blueprint:
    path: mcinnes01/send-camera-snapshot-when-event-type-detected.yaml
    input:
      notification_message: '{{ motion_sensor_name }} detected movement!'
      event_object: person
      motion_sensor: binary_sensor.motion_patio_camera
      override_sensor: binary_sensor.patio_door
      camera: camera.patio_camera
      notify_device: 646468413e957e6fe0d15b0f9624b670
      is_ios: true
      notification_title: Someone is in the garden!
      delay: 1
- id: '1631053327853'
  alias: Send snapshot when person is in the garden - Claire iPhone
  description: ''
  use_blueprint:
    path: mcinnes01/send-camera-snapshot-when-event-type-detected.yaml
    input:
      notification_message: '{{ motion_sensor_name }} detected movement!'
      event_object: person
      motion_sensor: binary_sensor.motion_patio_camera
      override_sensor: binary_sensor.patio_door
      camera: camera.patio_camera
      notify_device: 3cf9e880497a947bf86f81e62cdb9fc3
      is_ios: true
      notification_title: Someone is in the garden!
      delay: 1
- id: '1631299978783'
  alias: Lounge Lights Off Reset Mode
  description: ''
  trigger:
  - platform: state
    entity_id: light.lounge_lights
    to: 'off'
  condition: []
  action:
  - service: input_select.select_option
    target:
      entity_id: input_select.lounge_mode
    data:
      option: Normal
  mode: single
- id: '1631300005347'
  alias: Snug Lights Off Reset Mode
  description: ''
  trigger:
  - platform: state
    entity_id: light.snug_lights
    to: 'off'
  condition: []
  action:
  - service: input_select.select_option
    data:
      option: Normal
    target:
      entity_id: input_select.snug_mode
  mode: single
- id: '1631300046090'
  alias: Bedroom Lights Off Reset Mode
  description: ''
  trigger:
  - platform: state
    entity_id: light.bedroom_lights
    to: 'off'
  condition: []
  action:
  - service: input_select.select_option
    data:
      option: Normal
    target:
      entity_id: input_select.bedroom_mode
  mode: single
- id: '1632689336110'
  alias: Back Door Light Constrained
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.back_door_light_constrained,binary_sensor.patio_door,light.back_door
  condition: []
  action:
  - choose:
    - conditions:
      - condition: and
        conditions:
        - condition: template
          value_template: '{{ not is_state(''binary_sensor.patio_door'', ''off'')
            }}'
        - condition: sun
          before: sunrise
          after: sunset
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.back_door_light_constrained
    default:
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.back_door_light_constrained
  mode: single
- id: '1634076160865'
  alias: Bathroom Occupancy
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.bathroom_wasp
    id: occupied
    to: 'on'
  - platform: state
    entity_id: binary_sensor.bathroom_wasp
    id: vaccant
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: occupied
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id:
          - input_boolean.bathroom_light_constrained
          - input_boolean.mirror_light_constrained
    - conditions:
      - condition: trigger
        id: vaccant
      sequence:
      - service: input_boolean.turn_off
        target:
          entity_id:
          - input_boolean.bathroom_light_constrained
          - input_boolean.mirror_light_constrained
      - service: light.turn_off
        target:
          entity_id: light.bathroom_lights
    default: []
  mode: single
- id: '1634076359937'
  alias: Toilet Occupancy
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.toilet_wasp
    id: occupied
    to: 'on'
  - platform: state
    entity_id: binary_sensor.toilet_wasp
    id: vaccant
    to: 'off'
  condition:
  - condition: state
    entity_id: light.toilet
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: occupied
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.toilet_light_constrained
    default:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.toilet_light_constrained
    - service: light.turn_off
      target:
        entity_id: light.toilet
  mode: single
- id: '1634077012969'
  alias: Electric Cabinet Occupancy
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.electric_cabinet_door_contact
    id: occupied
    to: 'off'
  - platform: state
    entity_id: binary_sensor.electric_cabinet_door_contact
    id: vaccant
    to: 'on'
  condition:
  - condition: state
    entity_id: light.basement_hall
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: occupied
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.basement_hall_light_constrained
    default:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.basement_hall_light_constrained
    - service: light.turn_off
      target:
        entity_id: light.basement_hall
  mode: single
- id: '1638630199969'
  alias: Low battery level detection & notification for all battery sensors
  description: ''
  use_blueprint:
    path: sbyx/low-battery-level-detection-notification-for-all-battery-sensors.yaml
    input:
      actions:
      - device_id: 646468413e957e6fe0d15b0f9624b670
        domain: mobile_app
        type: notify
        message: 'Low battery warnings for the following devices: {{sensors}}'
        title: Low Battery Warning
